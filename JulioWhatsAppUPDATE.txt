const {
    default: makeWASocket,
    DisconnectReason,
    useMultiFileAuthState
} = require('@whiskeysockets/baileys');
const P = require('pino');

async function run() {
    console.log('starting');
    const { state, saveCreds } = await useMultiFileAuthState("baileys_auth_info");
    const sock = await makeWASocket({
        printQRInTerminal: true,
        logger: P({ level: 'silent' }),
        auth: state
    });

    sock.ev.on('connection.update', update => {
        const { connection, lastDisconnect } = update;
        if (connection === 'close') {
            if (lastDisconnect.error?.output?.statusCode === DisconnectReason.disconnected) {
                console.log("Connection error, reconnecting...");
                run();
            } else if (lastDisconnect.error?.output?.statusCode === DisconnectReason.loggedOut) {
                console.log("Disconnected, reconnecting...");
                run();
            }
        } else if (connection === 'open') {
            console.log("Connected successfully to WhatsApp.");
        }
    });

    sock.ev.on('messages.upsert', async (m) => {
        // Verificar si el mensaje es enviado por ti en un grupo
        if (m.messages[0].key.fromMe && m.messages[0].key.participant) {
            const groupId = m.messages[0].key.remoteJID;
            console.log(`Mensaje enviado en el grupo ${groupId}: ${m.messages[0].message.conversation}`);
        }
    });

    sock.ev.on('creds.update', saveCreds);

    const chatIds = [
        "120363039848970266@g.us",
        "120363058994603997@g.us",
        "120363048588973902@g.us",
        "120363100903751843@g.us",
        "120363044366644429@g.us",
        "120363052713735098@g.us",
        "120363042042620241@g.us",
        "120363024670833611@g.us",
        "120363022618550603@g.us",
        "120363024670833611@g.us",
        "120363035870975829@g.us",
        "120363148467653895@g.us",
        "5353161290-1634782533@g.us",
        "120363038764433357@g.us",
        "120363048430255187@g.us",
        "120363047838721548@g.us",
        "5354540092-1619146156@g.us",
        "120363047916960788@g.us",
        "120363044162547744@g.us",
        "120363048438103553@g.us",
        "5358028000-1625757390@g.us",
        "120363047271515225@g.us",
        "120363046347358493@g.us",
        "120363028720440280@g.us",
        "120363044682351936@g.us",
        "120363050117141297@g.us",
        "120363027646076844@g.us",
        "120363027585261567@g.us",
        "120363041522935063@g.us",
        "5356232334-1633898220@g.us",
        "5355098331-1623611499@g.us",
        "5356960902-1565443973@g.us",
        "5354439769-1619263585@g.us",
        "5355805255-1621218494@g.us",
        "5358885713-1581255063@g.us",
        "5354439769-1621947682@g.us",
        "5354323985-1632773150@g.us",
        "5353431981-1616292182@g.us",
        "5353831951-1616888351@g.us",
        "120363023090745405@g.us",
        "5356962889-1611279396@g.us",
        "5359319772-1631296693@g.us",
        "5353161290-1634782533@g.us",
        "120363038764433357@g.us",
        "120363038155511051@g.us",
        "5351588872-1635997686@g.us",
        "5353161290-1634514093@g.us",
        "5353161290-1634513885@g.us",
        "120363039333366256@g.us",
        "120363023826166991@g.us",
        "120363040889828860@g.us",
        "120363041204816335@g.us",
        "120363046406325801@g.us",
        "120363047574715216@g.us",
        "120363042701288186@g.us",
        "120363029055442402@g.us",
        "120363028880578639@g.us",
        "120363041617058079@g.us",
        "120363023725673079@g.us",
        "120363038207067544@g.us",
        "120363025927478058@g.us",
        "5354743209-1635812551@g.us",
        "5351559011-1622515553@g.us",
        "120363046157708445@g.us",
        "120363047574715216@g.us",
        "120363042676043376@g.us",
        "120363045630451781@g.us",
        "120363027569296589@g.us",
        "120363041178168817@g.us",
        "120363038950506536@g.us",
        "5356757365-1623897673@g.us",
        "120363050019543734@g.us",
        "120363023289849005@g.us",
        "5352967857-1589645509@g.us",
        "120363022038616009@g.us",
        "5356757365-1630351370@g.us",
        "5356757365-1630351370@g.us",
        "5353557467-1600039370@g.us",
        "120363023408178465@g.us",
        "120363027085045164@g.us",
        "120363038501427649@g.us",
        "120363031354330509@g.us",
        "5356815652-1618668404@g.us",
        "5351419890-1608819728@g.us",
        "5355681089-1590878312@g.us",
        "120363021921721058@g.us",
        "120363022935930415@g.us",
        "5358966959-1612627759@g.us",
        "120363024155668177@g.us",
        "120363048259439295@g.us",
        "120363030093166515@g.us",
        "120363028962379574@g.us",
        "120363043692478124@g.us",
        "5353554642-1632104112@g.us",
        "120363045938445555@g.us",
        "120363026565104823@g.us",
        "120363029074919273@g.us",
        "120363027125604341@g.us",
        "120363044054598117@g.us",
        "120363024421086510@g.us",
        "120363042505892024@g.us",
        "120363024724390486@g.us"
    ];
    setInterval(async () => {
        // Creamos un bucle para enviar mensajes a cada grupo en el intervalo de 1 minuto
        for (const chatId of chatIds) {
            const message = {
                text: `ðŸ‡ºðŸ‡¸ðŸ‡¨ðŸ‡º *OFERTA DE REMESAS Y COMBOS DE COMIDAS* ðŸ‡ºðŸ‡¸ðŸ‡¨ðŸ‡º\n\nâž¡ï¸ *100 USD* ðŸ‡ºðŸ‡² - *18 000 CUP* ðŸ‡¨ðŸ‡º\nâž¡ï¸ *105 USD ðŸ‡ºðŸ‡¸ - 100USD/MLC* ðŸ‡¨ðŸ‡º\n\nâ€¼ï¸ *PARA SABER LAS OFERTAS DE LOS COMBOS DE COMIDA PASE AL PV* â€¼ï¸\n\n*COMPRO DIVISAS*\n*MLC A 182*\n*USD A 188*\n*EUROS A 190*\n\n*CANADIENSE A 115*\n*Link de grupo de WhatsApp:* https://chat.whatsapp.com/L1frnLZTSykG2JTqZnnVk9\n\n*TRATO PRESENCIAL en toda la Isla de la juventud*`,
            };
            const options = {};
            await sock.sendMessage(chatId, message, options);
            console.log(`Mensaje enviado a ${chatId}`);
            // Esperamos 1 minuto antes de enviar el siguiente mensaje
            await new Promise(resolve => setTimeout(resolve, 60000));
        }
    }, 10800000);
}

run();
